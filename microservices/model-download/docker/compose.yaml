# Copyright (C) 2025 Intel Corporation
# SPDX-License-Identifier: Apache-2.0

services:
  model_download_service:
    image: ${REGISTRY}model-download:${TAG}
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: model-download
    command: --plugins ${ENABLED_PLUGINS:-all}
    environment:
      - no_proxy=${no_proxy:-}
      - HF_HUB_ENABLE_HF_TRANSFER=1
      - HF_TOKEN=${HUGGINGFACEHUB_API_TOKEN:-}
      - ENABLED_PLUGINS=${ENABLED_PLUGINS}
      - MODEL_PATH=${MODEL_PATH}
      - GETI_HOST=${GETI_HOST}
      - GETI_TOKEN=${GETI_TOKEN}
      - GETI_WORKSPACE_ID=${GETI_WORKSPACE_ID}
      - GETI_SERVER_API_VERSION=${GETI_SERVER_API_VERSION:-v1}
      - GETI_SERVER_SSL_VERIFY=${GETI_SERVER_SSL_VERIFY:-False}
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || exit 1"]
      interval: 60s
      timeout: 10s
      retries: 5
      start_period: 180s
    ports:
      - "8200:8000"
    volumes:
      - ${MODEL_PATH:-~/models}:/opt/models
    group_add:
      - ${USER_GROUP_ID:-1001}